<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Filtros</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header> 
        <nav class="nav_menu">
            <h3>GESTOR DE TAREAS</h3>
            <img id="logoImage" src="https://res.cloudinary.com/dvikvg6ml/image/upload/v1693860781/Benergy_logo_bueno_t2wwiw.png" width="150px" alt="">
        </nav>
    </header>
    <main>
        <section>
            <nav class="nav_menu2">
                <!-- lista de los campos -->
                <!-- <input type="text" id="filterFieldName" placeholder="Nombre del campo"> -->
                <div class="form-control-sm">
                    <select class="" name="filterFieldName" id="filterFieldName">
                        <option value="" disabled selected>Nombre del campo</option>
                        <option value="Nombre">Nombre</option>
                        <option value="Descripcion">Descripcion</option>
                        <option value="Precio">Precio</option>
                        <option value="Opciones">Opciones</option>
                        <option value="Table2">Table2</option>
                        <option value="Name">Name</option>
                    </select>
    
                    <select name="filterType" id="filterType">
                        <option value="" disabled selected>Operador</option>
                        <option value="Contains">Contiene</option>
                        <option value="Equals">Es igual a</option>
                        <option value="Greater">Mayor que</option>
                        <option value="Less">Menor que</option>
                        <option value="NotContains">No contiene</option>
                        <option value="NotEquals">No es igual a</option>
                        <option value="GreaterOrEqual">Mayor o igual que</option>
                        <option value="LessOrEqual">Menor o igual que</option>
    
                    </select>
                    <input type="text" id="filterValue" placeholder="Valor de filtro">
                    <div id="filtroContainer">

                    </div>

                    
                </div>
                
                
                <div class="botones" >
                    <button type="button" onclick="agregarFiltro()">Agregar filtro</button>
                    <button type="button" onclick="aplicarFiltros()">Aplicar filtro</button>
                    <button type="button"onclick="recargarIframe()">Actualizar</button>
                    <button type="button" onclick="limpiarFiltros()">Limpiar filtros</button>
                </div>
            </nav>
            <!-- Aqui se define URL base -->
            <!-- <div class="embed" data-src="https://airtable.com/embed/appU7lYsFSoNH4hGO/shrWxTyCNj6mt6jg1?backgroundColor=yellow" frameborder="0" onmousewheel="" width="100%" height="720" style= "background: transparent; border: 1px solid #ccc;"><div> -->

            <iframe id="myIframe" class="airtable-embed" src="https://airtable.com/embed/appU7lYsFSoNH4hGO/shrWxTyCNj6mt6jg1?backgroundColor=yellow" frameborder="0" onmousewheel="" width="100%" height="720" style= "background: transparent; border: 1px solid #ccc;"></iframe>
        </section>
    </main>
    <script src="apiLogo.js"></script>

</body>
<script>
    // Variable global para almacenar las condiciones
    const condiciones = [];

    // Función para agregar un filtro a la lista de filtros
    function agregarFiltro() {
        const campo = document.getElementById("filterFieldName").value;
        const valor = document.getElementById("filterValue").value;
        const tipoDeFiltro = document.getElementById("filterType").value;

        // Verifica si se han seleccionado valores válidos
        if (campo && tipoDeFiltro && valor) {
            // Agrega la condición actual al array de condiciones
            condiciones.push({ campo, tipoDeFiltro, valor });

            // Crea un conjunto de elementos HTML para mostrar el filtro agregado
            const filtroContainer = document.getElementById("filtroContainer");
            const filtroElement = document.createElement("div");
            filtroElement.innerHTML = `
                <select>
                    <option value="${campo}" selected>${campo}</option>
                </select>
                <select>
                    <option value="${tipoDeFiltro}" selected>${tipoDeFiltro}</option>
                </select>
                <input type="text" value="${valor}">
            `;
            filtroContainer.appendChild(filtroElement);

            // Limpia los campos de entrada
            document.getElementById("filterFieldName").value = "";
            document.getElementById("filterValue").value = "";
            document.getElementById("filterType").value = "";
            
        } else {
            alert("Por favor, complete todos los campos para agregar un filtro.");
        }
    }


    // Función para aplicar los filtros
    function aplicarFiltros() {
        // Verifica si hay al menos una condición para aplicar filtros
        if (condiciones.length > 0) {
            // Construir la URL del iframe con todas las condiciones
            let iframeUrl = "https://airtable.com/embed/appU7lYsFSoNH4hGO/shrWxTyCNj6mt6jg1?backgroundColor=yellow";
            condiciones.forEach((condicion, index) => {
                const { campo, tipoDeFiltro, valor } = condicion;
                const valorCodificado = encodeURIComponent(valor);
                iframeUrl += `&filter${tipoDeFiltro}_${campo}=${valorCodificado}`;
            });

            // Establecer la URL construida como fuente del iframe
            const iframe = document.getElementById("myIframe");
            iframe.src = iframeUrl;
        } else {
            alert("Agregue al menos un filtro antes de aplicar filtros.");
        }
    }

    // Función para limpiar los filtros
    function limpiarFiltros() {
        // Limpia la lista de filtros y el array de condiciones
        const filtroContainer = document.getElementById("filtroContainer");
        filtroContainer.innerHTML = "";
        condiciones.length = 0;

        // Restablecer la URL del iframe a la URL original sin filtros
        const iframe = document.getElementById("myIframe");
        iframe.src = "https://airtable.com/embed/appU7lYsFSoNH4hGO/shrWxTyCNj6mt6jg1?backgroundColor=yellow";

        // Limpia los campos de entrada y los radio buttons
        document.getElementById("filterFieldName").value = "";
        document.getElementById("filterValue").value = "";
        document.getElementById("filterType").value = "";
    }

    function recargarIframe(){
        const iframe = document.getElementById("myIframe");
        iframe.src = iframe.src; 
    }
    
</script>
</html>
